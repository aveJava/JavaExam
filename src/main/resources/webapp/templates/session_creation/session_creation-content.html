<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Session creation content</title>
</head>
<body>

    <div th:fragment="content" class="content">

        <div style="margin: 2vw 12.5vw;">

            <div style="font-size: 38px; font-style: italic; font-weight: 700;">Создание нового сеанса</div>

            <br><br>

            <div>
                <span>Загрузить схему</span>
                <select style="width: 7vw; margin-right: 5vw;"></select>
                <form method="get" action="/session_creation/new_schema" style="display: inline-block;">
                    <span>Новая схема на</span>
                    <input type="number" name="num_of_fields" style="width: 2vw; margin: 0 0.5vw;">
                    <span>разделов</span>
                    <input type="submit" value="Создать" style="margin-left: 0.5vw;">
                </form>
            </div>

            <br><br>

            <!-- Если в схемме сессии есть хотя бы один юнит (раздел) -->
            <div th:if="${SchemaModel != null && SchemaModel.getUnits().size() > 0}"
                 th:with="units = ${SchemaModel.getUnits()}">

                <!-- Шапка -->
                <div style="font-weight: 700; font-style: italic; margin: 1vw 0;">
                    <div style="width: 6.75vw; margin-right: 3vw; display: inline-block;">Paздел</div>
                    <div style="display: inline-block;">Темы раздела и количества вопросов (из каких тем и сколько вопросов включить в тест)</div>
                </div>

                <!-- Форма редактирования схемы сессии -->
                <form method="post" th:object="${SchemaModel}">
                    <input type="hidden" name="id" th:value="${SchemaModel.getId()}">
                    <!-- Вывод всех юнитов -->
                    <div th:each="unitNumber : ${#numbers.sequence(0, units.size() - 1)}" style="display: flex; margin: 1vw 0"
                         th:with="unit = ${units.get(unitNumber)}">

                        <input type="hidden" th:name="'units[' + ${unitNumber} + '].id'" th:value="${units.get(unitNumber).getId()}">
                        <input type="hidden" th:name="'units[' + ${unitNumber} + '].sessionSchemaId'" th:value="${units.get(unitNumber).getSessionSchemaId()}">

                        <!-- Раздел -->
                        <select th:name="'units[' + ${unitNumber} + '].foKn'" class="UnitFoKn" onchange="window.location.href = this.options[this.selectedIndex].value">
                            <option th:if="${unit.getFoKn() != null}"></option>
                            <option selected th:text="${unit.getFoKn()}"></option>
                            <th:block th:each="foKn : ${fieldsOfKn}">
                                <option th:if="${!foKn.getName().equals(unit.getFoKn())}"
                                        th:value="'/session_creation/change_schema_foKn?unit_number=' + ${unitNumber} + '&' + 'foKn_name=' + ${foKn.getName()}">[[${foKn.getName()}]]</option>
                            </th:block>
                        </select>
                        <div>
                            <!-- Темы и количества вопросов -->
                            <div style="display: flex;">
                                <div th:each="topicNumber : ${#numbers.sequence(0, 9)}" class="UnitTopicAndQuantity">
                                    <!-- Если раздел для данного юнита еще не выбран (отображаются пустые неактивные поля) -->
                                    <div th:if="${unit.getFoKn() == null || unit.getFoKn().isEmpty()}">
                                        <input type="text" th:placeholder="'Тема №' + ${topicNumber + 1}" disabled style="width: 93%;">
                                        <input type="number" style="width: 2vw;" disabled>
                                    </div>
                                    <!-- Если раздел для данного юнита уже выбран -->
                                    <div th:if="${!(unit.getFoKn() == null) && !unit.getFoKn().isEmpty()}">
                                        <select th:name="'units[' + ${unitNumber} + '].topics[' + ${topicNumber} + ']'"
                                                th:with="topics = ${unit.getTopics()},
                                                         isSelected = ${topics != null && topics.size() > topicNumber && !topics.get(topicNumber).isEmpty()}"
                                                style="width: 100%;">
                                            <option selected th:text="${isSelected} ? ${unit.getTopics().get(topicNumber)} : ''"></option>
                                            <th:block th:each="topic : ${topicService.findAllByFoKnName(unit.getFoKn())}">
                                                <option>[[${topic.getName()}]]</option>
                                            </th:block>
                                        </select>
                                        <input type="number" th:name="'units[' + ${unitNumber} + '].quantityQuestions[' + ${topicNumber} + ']'" style="width: 2vw;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Кнопки -->
                    <div>
                        <label for="SchemaName" style="font-size: 14px;">Имя схемы (если ее нужно сохранить)</label>
                        <input type="text" id="SchemaName" name="name" th:value="${SchemaModel.getName()}" style="width: 8.3vw; margin: 0.7vw 40vw 0.7vw 0;">
                        <input type="submit" value="Сохранить схему" onclick='this.form.action="/session_schemes";'>
                        <input type="submit" value="Создать сеанс по данной схеме" onclick='this.form.action="somethingelse";'>
                    </div>
                </form>

            </div>

        </div>

    </div>

</body>
</html>